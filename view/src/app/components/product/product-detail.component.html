<app-header></app-header>

<!-- LOADING -->
<div *ngIf="loading" class="text-center my-3">
  Đang tải sản phẩm...
</div>

<!-- PRODUCT DETAIL -->
<div *ngIf="!loading && product" class="container my-4">

  <button class="btn btn-light mb-3" (click)="goBack()">← Quay lại</button>

  <div class="row">

    <!-- IMAGE -->
    <div class="col-md-6 text-center">
      <img
        *ngIf="mainImage; else noImage"
        [src]="mainImage"
        class="img-fluid rounded shadow-sm mb-3"
        style="max-height: 400px; object-fit: cover;"
        alt="{{ product.name }}"
      >

      <ng-template #noImage>
        <img
          src="assets/no-image.png"
          class="img-fluid rounded shadow-sm mb-3"
          style="max-height: 400px; object-fit: cover;"
          alt="No image"
        >
      </ng-template>
    </div>

    <!-- INFO -->
    <div class="col-md-6">

      <h2>{{ product.name }}</h2>

      <p class="text-danger fw-bold fs-5">
        Giá: {{ product.price | currency:'VND' }}
      </p>

      <p>
        <strong>Danh mục:</strong>
        {{ product.category?.name || 'Không có' }}
      </p>

      <p>
        <strong>Trạng thái:</strong>
        <span
          [class.text-success]="(product.quantity ?? 0) > 0"
          [class.text-danger]="(product.quantity ?? 0) <= 0">
          {{ (product.quantity ?? 0) > 0 ? 'Còn hàng' : 'Hết hàng' }}
        </span>
      </p>

      <!-- QUANTITY -->
      <div *ngIf="product.id !== undefined" class="mb-3">
        <label class="form-label">Số lượng</label>
        <input
          type="number"
          min="1"
          class="form-control w-50"
          [(ngModel)]="quantities[product.id]"
        />
      </div>

      <!-- ACTIONS -->
      <div class="d-flex gap-2 flex-wrap">

        <button
          class="btn btn-primary"
          (click)="addToCart(product.id)">
          Thêm vào giỏ hàng
        </button>

        <button
          *ngIf="isAdmin"
          class="btn btn-warning"
          (click)="edit()">
          Sửa
        </button>

        <button
          *ngIf="isAdmin"
          class="btn btn-danger"
          (click)="delete()">
          Xóa
        </button>

      </div>

      <!-- DESCRIPTION -->
      <p class="mt-3">
        {{ product.description }}
      </p>

    </div>
  </div>
</div>
